<!--pages/Assessment/assessment.wxml-->
<view class="assessment-container">
  <!-- æµ‹è¯„å¤´éƒ¨ -->
  <view class="assessment-header">
    <view class="progress-bar">
      <view class="progress-fill" style="width: {{(currentQuestionIndex / totalQuestions) * 100}}%"></view>
    </view>
    <view class="progress-text">
      ç¬¬{{currentQuestionIndex + 1}}é¢˜ / å…±{{totalQuestions}}é¢˜
    </view>
  </view>

  <!-- é¢˜ç›®å†…å®¹ -->
  <view class="question-card" wx:if="{{questions.length > 0}}">
    <view class="question-title">
      {{currentQuestion.question}}
    </view>

    <!-- å•é€‰é¢˜é€‰é¡¹ -->
    <view class="options-group" wx:if="{{currentQuestion.type === 'single_choice'}}">
      <view
        class="option-item {{selectedAnswer === option.key ? 'selected' : ''}}"
        wx:for="{{currentQuestion.options}}"
        wx:key="key"
        bindtap="selectAnswer"
        data-option="{{option.key}}"
      >
        <view class="option-label">{{option.key}}</view>
        <view class="option-text">{{option.text}}</view>
      </view>
    </view>

    <!-- å¤šé€‰é¢˜é€‰é¡¹ -->
    <view class="options-group" wx:if="{{currentQuestion.type === 'multiple_choice'}}">
      <view
        class="option-item {{selectedAnswers.indexOf(option.key) > -1 ? 'selected' : ''}}"
        wx:for="{{currentQuestion.options}}"
        wx:key="key"
        bindtap="toggleAnswer"
        data-option="{{option.key}}"
      >
        <view class="option-label">{{option.key}}</view>
        <view class="option-text">{{option.text}}</view>
        <view class="option-checkbox {{selectedAnswers.indexOf(option.key) > -1 ? 'checked' : ''}}">
          âœ“
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæŒ‰é’® -->
  <view class="bottom-actions">
    <button
      class="btn btn-primary"
      bindtap="nextQuestion"
      disabled="{{!canProceed}}"
    >
      {{currentQuestionIndex < totalQuestions - 1 ? 'ä¸‹ä¸€é¢˜' : 'æäº¤æµ‹è¯„'}}
    </button>
  </view>

  <!-- æµ‹è¯„ç»“æœé¡µé¢ -->
  <view class="result-container" wx:if="{{showResult}}">
    <view class="result-header">
      <view class="result-icon">âœ“</view>
      <view class="result-title">æµ‹è¯„å®Œæˆï¼</view>
    </view>

    <view class="result-card">
      <view class="result-item">
        <view class="result-label">æ€»å¾—åˆ†</view>
        <view class="result-value">{{assessmentResult.total_score}}</view>
      </view>

      <view class="result-item">
        <view class="result-label">å­¦ä¹ æ°´å¹³</view>
        <view class="result-value level-{{assessmentResult.level}}">
          {{assessmentResult.level === 'beginner' ? 'åˆçº§' :
            assessmentResult.level === 'intermediate' ? 'ä¸­çº§' : 'é«˜çº§'}}
        </view>
      </view>
    </view>

    <view class="result-section">
      <view class="section-title">ä½ çš„ä¼˜åŠ¿</view>
      <view class="advantage-list">
        <view class="advantage-item" wx:for="{{assessmentResult.strengths}}" wx:key="index">
          <view class="advantage-icon">âœ“</view>
          <view class="advantage-text">{{item}}</view>
        </view>
      </view>
    </view>

    <view class="result-section">
      <view class="section-title">éœ€è¦æå‡çš„æ–¹é¢</view>
      <view class="weakness-list">
        <view class="weakness-item" wx:for="{{assessmentResult.weaknesses}}" wx:key="index">
          <view class="weakness-icon">!</view>
          <view class="weakness-text">{{item}}</view>
        </view>
      </view>
    </view>

    <view class="result-section">
      <view class="section-title">å­¦ä¹ å»ºè®®</view>
      <view class="recommendation-list">
        <view class="recommendation-item" wx:for="{{assessmentResult.recommendations}}" wx:key="index">
          <view class="recommendation-icon">ğŸ’¡</view>
          <view class="recommendation-text">{{item}}</view>
        </view>
      </view>
    </view>

    <view class="result-actions">
      <button class="btn btn-primary" bindtap="generateLearningPath">
        ç”Ÿæˆä¸ªæ€§åŒ–å­¦ä¹ è·¯å¾„
      </button>
      <button class="btn btn-secondary" bindtap="retryAssessment">
        é‡æ–°æµ‹è¯„
      </button>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
</view>
