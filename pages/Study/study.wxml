<!--pages/Study/study.wxml-->
<view class="study-container">
	<!-- 学习提醒 -->
	<view class="reminders-section" wx:if="{{learningReminders.length > 0}}">
		<view class="section-header" bindtap="toggleReminders">
			<text class="section-title">学习提醒</text>
			<image class="arrow-icon {{showReminders ? 'expanded' : ''}}" src="/assets/images/arrow@2x.png" alt="" />
		</view>
		<view class="reminders-list" wx:if="{{showReminders}}">
			<view class="reminder-item" wx:for="{{learningReminders}}" wx:key="{{item.id}}">
				<view class="reminder-content">
					<text class="reminder-title">{{item.title}}</text>
					<text class="reminder-message">{{item.message}}</text>
					<view class="reminder-meta">
						<text class="reminder-priority priority-{{item.priority}}">{{item.priority === 'high' ? '高' : item.priority === 'medium' ? '中' : '低'}} priority</text>
						<text class="reminder-deadline" wx:if="{{item.deadline}}">截止: {{item.deadline}}</text>
					</view>
				</view>
				<button class="read-btn" bindtap="markReminderAsRead" data-reminder-id="{{item.id}}">
					已读
				</button>
			</view>
		</view>
	</view>

	<!-- 学习目标 -->
	<view class="goals-section">
		<view class="section-header" bindtap="toggleGoals">
			<text class="section-title">学习目标</text>
			<image class="arrow-icon {{showGoals ? 'expanded' : ''}}" src="/assets/images/arrow@2x.png" alt="" />
			<button class="add-goal-btn" bindtap="showAddGoalModal">
				+
			</button>
		</view>
		<view class="goals-list" wx:if="{{showGoals}}">
			<view class="goal-item" wx:for="{{learningGoals}}" wx:key="{{item.id}}">
				<view class="goal-content">
					<text class="goal-title">{{item.title}}</text>
					<text class="goal-description">{{item.description}}</text>
					<view class="goal-meta">
						<view class="progress-bar-small">
							<view class="progress-fill-small" style="width: {{item.progress}}%"></view>
						</view>
						<text class="progress-text-small">{{item.progress}}% 完成</text>
						<text class="goal-period">{{item.start_date}} 至 {{item.end_date}}</text>
					</view>
				</view>
				<view class="goal-status status-{{item.status}}">
					{{item.status === 'in_progress' ? '进行中' : item.status === 'completed' ? '已完成' : '未开始'}}
				</view>
			</view>
			<view class="empty-goals" wx:if="{{learningGoals.length === 0}}">
				<text class="empty-tip">您还没有设置学习目标，点击右上角"+"添加</text>
			</view>
		</view>
	</view>

	<!-- 学习进度 -->
	<view class="progress-section">
		<view class="section-header">
			<text class="section-title">学习进度</text>
		</view>
		<view wx:if="{{!isEmpty}}" class="study-item" wx:for="{{studyProgresses}}" wx:key="{{item.sid}}">
			<image src="{{item.icon}}" alt="" />
			<view class="meta">
				<text class="title">{{item.title}}</text>
				<text class="progress">已学习{{item.study_hour}}课时/{{item.total_hour || 0}}课时</text>
			</view>
			<view class="circle">
				<circle canvasId="{{item.sid}}" progress="{{item.study_progress}}" width="{{55}}" height="{{55}}"></circle>
			</view>
		</view>
		<view wx:if="{{isEmpty}}">
			<text class="no-study-tip">您还没有任何学习记录哦，赶快去学习吧~</text>
		</view>
	</view>
</view>

<!-- 添加学习目标模态框 -->
<view class="modal-overlay" wx:if="{{showAddGoalModal}}" bindtap="hideAddGoalModal">
	<view class="modal-content" catchtap="stopPropagation">
		<view class="modal-header">
			<text class="modal-title">添加学习目标</text>
			<text class="modal-close" bindtap="hideAddGoalModal">×</text>
		</view>
		<view class="modal-body">
			<view class="form-item">
				<text class="form-label">目标标题</text>
				<input
					class="form-input"
					placeholder="请输入目标标题"
					value="{{newGoal.title}}"
					data-field="title"
					bindinput="handleGoalInput"
				/>
			</view>
			<view class="form-item">
				<text class="form-label">目标描述</text>
				<textarea
					class="form-textarea"
					placeholder="请输入目标描述"
					value="{{newGoal.description}}"
					data-field="description"
					bindinput="handleGoalInput"
					auto-height
				/>
			</view>
			<view class="form-item">
				<text class="form-label">截止日期</text>
				<picker
					class="form-picker"
					mode="date"
					value="{{newGoal.end_date}}"
					start="{{today}}"
					bindchange="handleGoalInput"
					data-field="end_date"
				>
					<view class="picker-text">{{newGoal.end_date || '请选择截止日期'}}</view>
				</picker>
			</view>
		</view>
		<view class="modal-footer">
			<button class="modal-btn btn-cancel" bindtap="hideAddGoalModal">取消</button>
			<button class="modal-btn btn-confirm" bindtap="createLearningGoal">确认创建</button>
		</view>
	</view>
</view>

